{% extends "base.html" %}

{% block content %}
<div class="container-fluid p-0" style="height: 100vh; background: linear-gradient(135deg, #e7fffd 0%, #befffa 100%);">
    <div class="row g-0" style="height: 100vh;">
        <!-- Chat Interface -->
        <div class="col-md-6 p-4 d-flex flex-column" style="background-color: #e7fffd;">
            <div class="chat-header mb-4">
                <div class="d-flex justify-content-between align-items-center">
                    <h3 class="mb-0" style="color: #26ffed; text-shadow: 1px 1px 2px rgba(0,0,0,0.1);">
                        <i class="fas fa-robot me-2"></i>CV Builder Assistant
                    </h3>
                    <a href="{{ url_for('home') }}" class="btn btn-outline-primary" style="border-color: #26ffed; color: #26ffed;">
                        <i class="fas fa-home me-2"></i>Home
                    </a>
                </div>
            </div>
            <div class="chat-messages flex-grow-1 overflow-auto mb-4 p-3" id="chatMessages" 
                 style="background-color: white; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                <!-- Messages will be added here dynamically -->
            </div>
            <div class="chat-input">
                <form id="chatForm" class="d-flex gap-2">
                    <input type="text" id="userInput" class="form-control" 
                           placeholder="Type your message..." 
                           style="border-radius: 25px; border: 2px solid #befffa; padding: 12px 20px;">
                    <button type="submit" class="btn btn-primary" 
                            style="border-radius: 25px; background-color: #26ffed; border: none; padding: 12px 25px;">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </form>
            </div>
        </div>

        <!-- CV Preview -->
        <div class="col-md-6 p-4" style="background-color: #befffa;">
            <div class="cv-preview h-100">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h3 class="mb-0" style="color: #26ffed; text-shadow: 1px 1px 2px rgba(0,0,0,0.1);">
                        <i class="fas fa-file-alt me-2"></i>CV Preview
                    </h3>
                    <button class="btn btn-outline-primary" style="border-color: #26ffed; color: #26ffed;">
                        <i class="fas fa-download me-2"></i>Download CV
                    </button>
                </div>
                <div id="cvPreview" class="border p-4 h-100" 
                     style="background-color: white; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                    <!-- CV content will be rendered here -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Bootstrap and custom styles -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
<style>
    body {
        overflow: hidden;
    }
    .chat-messages {
        max-height: calc(100vh - 200px);
        overflow-y: auto;
    }
    .message {
        margin-bottom: 1rem;
        padding: 0.8rem 1.2rem;
        border-radius: 1rem;
        max-width: 80%;
        position: relative;
    }
    .user-message {
        background-color: #26ffed;
        color: #333;
        margin-left: auto;
        border-bottom-right-radius: 0.3rem;
    }
    .bot-message {
        background-color: #e7fffd;
        color: #333;
        margin-right: auto;
        border-bottom-left-radius: 0.3rem;
    }
    .message::after {
        content: '';
        position: absolute;
        bottom: 0;
        width: 20px;
        height: 20px;
    }
    .user-message::after {
        right: -10px;
        background: linear-gradient(45deg, transparent 50%, #26ffed 50%);
    }
    .bot-message::after {
        left: -10px;
        background: linear-gradient(45deg, #e7fffd 50%, transparent 50%);
    }
    /* Custom scrollbar */
    .chat-messages::-webkit-scrollbar {
        width: 6px;
    }
    .chat-messages::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
    }
    .chat-messages::-webkit-scrollbar-thumb {
        background: #26ffed;
        border-radius: 10px;
    }
    .chat-messages::-webkit-scrollbar-thumb:hover {
        background: #54fff1;
    }
    /* Input focus styles */
    #userInput:focus {
        box-shadow: 0 0 0 0.25rem rgba(38, 255, 237, 0.25);
        border-color: #26ffed;
    }
    /* Button hover effects */
    .btn-primary:hover {
        background-color: #54fff1 !important;
        transform: translateY(-1px);
        transition: all 0.2s ease;
    }
</style>

<!-- Add JavaScript for chat functionality -->
<script>
document.getElementById('chatForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const userInput = document.getElementById('userInput');
    const message = userInput.value.trim();
    
    if (message) {
        // Add user message to chat
        addMessage(message, 'user');
        userInput.value = '';

        try {
            // Send message to backend
            const response = await fetch('/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ message: message })
            });
            
            const data = await response.json();
            
            // Add bot response to chat
            addMessage(data.response, 'bot');
            
            // Update CV preview if provided
            if (data.cv_update) {
                updateCVPreview(data.cv_update);
            }
        } catch (error) {
            console.error('Error:', error);
            addMessage('Sorry, there was an error processing your request.', 'bot');
        }
    }
});

function addMessage(text, sender) {
    const messagesDiv = document.getElementById('chatMessages');
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${sender}-message`;
    messageDiv.textContent = text;
    messagesDiv.appendChild(messageDiv);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

function updateCVPreview(cvData) {
    const previewDiv = document.getElementById('cvPreview');
    previewDiv.innerHTML = cvData;
}
</script>
{% endblock %} 